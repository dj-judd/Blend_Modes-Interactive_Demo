<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --bg-color: #333;  /* Default to dark mode */
            --fg-color: #eaeaea;
        }
        
        body {
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s, color 0.3s;
            background-color: var(--bg-color);
            color: var(--fg-color);
        }

        #app-container {
            width: 90%;
            padding: 2em;
            display: flex;
            flex-direction: row;
        }
        
        #options-container {
            position: relative;
            width: 15%;
            height: fit-content;
            margin-left: 2em;
            padding-top: 0.5em;
            padding-bottom: 0.5em;
            padding-left: 1em;
            padding-right: 1em;
            border: 0.15em solid currentColor;
            border-radius: 1.5em;
            display: flex;
            flex: 0.01;
            flex-direction: column;
            justify-content: space-between;
            font-family: monospace;
        }

        .option {
            border-bottom: 0.15em solid var(--fg-color);
            padding-top: 1em;
            padding-bottom: 1em;
        }

        .option:last-child {
            border-bottom: none;
        }

        #image-container {
            position: relative;
            width: 85%;
            height: 0;
            padding-bottom: 70%;
            overflow: hidden;
        }

        #dark-mode-toggle {
            margin-bottom: 0em;
            padding-bottom: 0;
        }

        #formula-container {
            /* margin-top: 20px; */
            font-family: monospace;
        }

        #blend-mode-math {
            font-family: monospace;
        }

        #description-container {
            font-family: monospace;
            font-weight: lighter;
        }

        #graph-container {
            
        }

        #blend-mode-description-text {
            font-family: monospace;
        }
        
    </style>
</head>
<body class="dark-mode">
    <div id="app-container">
        <div id="image-container">
            <img src="https://www.travelandleisure.com/thmb/THxPADyupy5etEHl-wJ85lGnGwA=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/hollywood-sign-HWSECRETS0916-2000-3062f54393bb4273a4fe35a53177c45b.jpg" id="bottom-image">
        </div>

        <div id="options-container">
            <h2 style="margin-top: 0; margin-bottom: 0;">Options:</h2>

            <div id="blend-mode-select" class="option">
                <label for="blend-mode">Choose a blend mode:</label>
                <select name="blend-mode" id="blend-mode">
                    <option value="normal">Normal</option>
                    <option value="disolve">Dissolve</option>
                    <option disabled>──────────</option>
                    <option value="darken">Darken</option>
                    <option value="multiply">Multiply</option>
                    <option value="color-burn">Color Burn</option>
                    <option value="linear-burn">Linear Burn</option>
                    <option value="darker-color">Darker Color</option>
                    <option disabled>──────────</option>
                    <option value="lighten">Lighten</option>
                    <option value="screen">Screen</option>
                    <option value="color-dodge">Color Dodge</option>
                    <option value="linear-dodge">Linear Dodge (Add)</option>
                    <option value="lighter-color">Lighter Color</option>
                    <option disabled>──────────</option>
                    <option value="overlay">Overlay</option>
                    <option value="soft-light">Soft Light</option>
                    <option value="hard-light">Hard Light</option>
                    <option value="vivid-light">Vivid Light</option>
                    <option value="linear-light">Linear Light</option>
                    <option value="pin-light">Pin Light</option>
                    <option value="hard-mix">Hard Mix</option>
                    <option disabled>──────────</option>
                    <option value="difference">Difference</option>
                    <option value="exclusion">Exclusion</option>
                    <option value="subtract">Subtract</option>
                    <option value="divide">Divide</option>
                    <option disabled>──────────</option>
                    <option value="hue">Hue</option>
                    <option value="saturation">Saturation</option>
                    <option value="color">Color</option>
                    <option value="luminosity">Luminosity</option>
                </select>
            </div>

            <div id="color-select" class="option">
                <label for="color">Choose a color:</label>
                <input type="color" id="color" name="color" value="#ff1493">
            </div>

            <div id="color-wipe-slider" class="option">
                <label for="color-wipe">Color Wipe:</label>
                <input type="range" min="0" max="100" value="0" id="color-wipe">
            </div>

            <div id="description-container" class="option">
                <h3>Blend Mode Description</h3>
                <p id="blend-mode-description-text"></p>
            </div>

            <div id="graph-container" class="option">
                
            </div>

            <div id="formula-container" class="option">
                <h3>Blend Mode Formula</h3>
                <p id="blend-mode-math"></p>
            </div>
            
            <div id="dark-mode-toggle" class="option" style="margin-bottom: 0;">
                <label for="dark-mode">Dark mode:</label>
                <input type="checkbox" id="dark-mode" checked>
            </div>
        </div>
    </div>
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true,
                packages: ['base', 'ams']
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                ignoreHtmlClass: 'tex2jax_ignore',
                renderActions: {
                    find: [10, function (doc) {
                        for (const math of doc.math) {
                            if (!math.mathml && math.inputJax === 'TeX') {
                                math.state = MathJax.ElementJax.STATE.PROCESSED;
                                math.outputJax.previewClear(math);
                            }
                        }
                    }]
                }
            },
            loader: {
                load: ['input/tex', 'output/chtml', 'ui/menu']
            }
        };

        window.onload = function() {
            const blendModeSelect = document.querySelector('#blend-mode');
            const colorSelect = document.querySelector('#color');
            const darkModeToggle = document.querySelector('#dark-mode');
    
            const blendModes = {
                normal: {
                    formula: '\\text{Result} = T',
                    definition: 'This mode simply retains the top layer.'
                },
                dissolve: {
                    formula: '',
                    definition: 'Affects the layer randomly.'
                },
                darken: {
                    formula: '\\text{Result} = \\min(B, T)',
                    definition: 'This mode selects the darker color between the top and bottom layer for each pixel.'
                },
                multiply: {
                    formula: '\\text{Result} = B \\times T',
                    definition: 'This mode multiplies the colors of the top and bottom layer, resulting in a darker color.'
                },
                'color-burn': {
                    formula: '\\text{Result} = 1 - \\frac{1 - B}{T}',
                    definition: 'Intensifies the darker tones in your image.'
                },
                'linear-burn': {
                    formula: '',
                    definition: 'Similar to Multiply but with more intense results. Exact formula varies.'
                },
                'darker-color': {
                    formula: '',
                    definition: 'Compares the total of all channel values for the blend and base color and retains the lower value color. Exact formula varies.'
                },
                lighten: {
                    formula: '\\text{Result} = \\max(B, T)',
                    definition: 'This mode selects the lighter color between the top and bottom layer for each pixel.'
                },
                screen: {
                    formula: '\\text{Result} = 1 - (1 - B) \\times (1 - T)',
                    definition: 'This mode multiplies the inverses of the colors of the top and bottom layer, resulting in a lighter color.'
                },
                'color-dodge': {
                    formula: '\\text{Result} = \\frac{B}{1 - T}',
                    definition: 'Brightens your image by decreasing contrast.'
                },
                'linear-dodge': {
                    formula: '',
                    definition: 'Similar to Screen but with more intense results. Exact formula varies.'
                },
                'lighter-color': {
                    formula: '',
                    definition: 'Compares the total of all channel values for the blend and base color and retains the higher value color. Exact formula varies.'
                },
                overlay: {
                    formula: '\\text{Result} = (B < 0.5) ? (2 \\times B \\times T) : (1 - 2 \\times (1 - B) \\times (1 - T))',
                    definition: 'This mode multiplies or screens the colors depending on the base color.'
                },
                'soft-light': {
                    formula: '\\text{Result} = (T < 0.5) ? (2 \\times B \\times T + B^2) : (2 \\times B \\times (1 - T) + \\sqrt{B})',
                    definition: 'This mode darkens or lightens the colors by decreasing or increasing the contrast, depending on the blend color.'
                },
                'hard-light': {
                    formula: '\\text{Result} = (T < 0.5) ? (2 \\times B \\times T) : (1 - 2 \\times (1 - B) \\times (1 - T))',
                    definition: 'This mode multiplies or screens the colors depending on the blend color.'
                },
                'vivid-light': {
                    formula: '',
                    definition: 'Burns or dodges the colors by increasing or decreasing the contrast, depending on the blend color. Exact formula varies.'
                },
                'linear-light': {
                    formula: '',
                    definition: 'Burns or dodges the colors by decreasing or increasing the brightness, depending on the blend color. Exact formula varies.'
                },
                'pin-light': {
                    formula: '',
                    definition: 'Replaces the colors, depending on the blend color. Exact formula varies.'
                },
                'hard-mix': {
                    formula: '',
                    definition: 'Adds the red, green, and blue channel values of the blend color to those of the base color. Exact formula varies.'
                },
                difference: {
                    formula: '\\text{Result} = |B - T|',
                    definition: 'This mode subtracts the bottom layer color from the top layer or vice versa, depending on which one is lighter.'
                },
                exclusion: {
                    formula: '\\text{Result} = B + T - 2 \\times B \\times T',
                    definition: 'This mode creates an effect similar to Difference, but with lower contrast.'
                },
                subtract: {
                    formula: '',
                    definition: 'Looks at the color information in each channel and subtracts the blend color from the base color. Exact formula varies.'
                },
                divide: {
                    formula: '',
                    definition: 'Looks at the color information in each channel and divides the base color by the blend color. Exact formula varies.'
                },
                hue: {
                    formula: '',
                    definition: 'Result uses the hue of the TopLayer and the saturation and luminosity of the BottomLayer.'
                },
                saturation: {
                    formula: '',
                    definition: 'Result uses the saturation of the TopLayer and the hue and luminosity of the BottomLayer.'
                },
                color: {
                    formula: '',
                    definition: 'Result uses the hue and saturation of the TopLayer and the luminosity of the BottomLayer.'
                },
                luminosity: {
                    formula: '',
                    definition: 'Result uses the luminosity of the TopLayer and the hue and saturation of the BottomLayer.'
                }
            };
    
            if (darkModeToggle.checked) {
                document.body.classList.add('dark-mode');
            }

            const updateBlendMode = (mode) => {
                if (blendModes[mode]) {
                    document.getElementById('blend-mode-math').textContent = blendModes[mode].formula;
                    document.getElementById('blend-mode-description-text').textContent = blendModes[mode].definition;
                    // Run MathJax again after updating the text content
                    MathJax.typesetPromise();
                } else {
                    document.getElementById('blend-mode-math').textContent = 'No formula available for this blend mode';
                    document.getElementById('blend-mode-description-text').textContent = '';
                }
            };
    
            blendModeSelect.addEventListener('change', (event) => {
                updateBlendMode(event.target.value);
            });

            colorSelect.addEventListener('change', (event) => {
                // No need to handle color changes
            });

            darkModeToggle.addEventListener('change', (event) => {
                if(event.target.checked) {
                    document.documentElement.style.setProperty('--bg-color', '#333');
                    document.documentElement.style.setProperty('--fg-color', '#eaeaea');
                } else {
                    document.documentElement.style.setProperty('--bg-color', '#eaeaea');
                    document.documentElement.style.setProperty('--fg-color', '#333');
                }
            });

            // Update blend mode initially
            updateBlendMode(blendModeSelect.value);

            // MathJax setup
            MathJax.startup.document.state(10);
            MathJax.startup.document.clear();
            MathJax.startup.document.updateDocument();
            MathJax.typesetPromise();
        };
    </script>
</body>
</html>