<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-color: #333;  /* Default to dark mode */
            --fg-color: #eaeaea;
        }
        
        body {
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s, color 0.3s;
            background-color: var(--bg-color);
            color: var(--fg-color);
        }

        #app-container {
            width: 90%;
            padding: 2em;
            display: flex;
            flex-direction: row;
        }
        
        #options-container {
            position: relative;
            width: 15%;
            height: fit-content;
            margin-left: 2em;
            padding-top: 0.5em;
            padding-bottom: 0.5em;
            padding-left: 1em;
            padding-right: 1em;
            border: 0.15em solid currentColor;
            border-radius: 1.5em;
            display: flex;
            flex: 0.01;
            flex-direction: column;
            justify-content: space-between;
            font-family: monospace;
        }

        .option {
            border-bottom: 0.15em solid var(--fg-color);
            padding-top: 1em;
            padding-bottom: 1em;
        }

        .option:last-child {
            border-bottom: none;
        }

        #image-container {
            position: relative;
            width: 85%;
            height: 0;
            padding-bottom: 70%;
            overflow: hidden;
        }

        #dark-mode-toggle {
            margin-bottom: 0em;
            padding-bottom: 0;
        }

        #formula-container {
            /* margin-top: 20px; */
            font-family: monospace;
        }

        #blend-mode-math {
            font-family: monospace;
        }

        #description-container {
            font-family: monospace;
            font-weight: lighter;
        }

        #graph-container {
            
        }

        #blend-mode-description-text {
            font-family: monospace;
        }
        
    </style>
</head>
<body class="dark-mode">
    <div id="app-container">
        <div id="image-container">
            <img src="https://www.travelandleisure.com/thmb/THxPADyupy5etEHl-wJ85lGnGwA=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/hollywood-sign-HWSECRETS0916-2000-3062f54393bb4273a4fe35a53177c45b.jpg" id="bottom-image">
        </div>

        <div id="options-container">
            <h2 style="margin-top: 0; margin-bottom: 0;">Options:</h2>

            <div id="blend-mode-select" class="option">
                <label for="blend-mode">Choose a blend mode:</label>
                <select name="blend-mode" id="blend-mode">
                    <option value="normal">Normal</option>
                    <option value="disolve">Dissolve</option>
                    <option disabled>──────────</option>
                    <option value="darken">Darken</option>
                    <option value="multiply">Multiply</option>
                    <option value="color-burn">Color Burn</option>
                    <option value="linear-burn">Linear Burn</option>
                    <option value="darker-color">Darker Color</option>
                    <option disabled>──────────</option>
                    <option value="lighten">Lighten</option>
                    <option value="screen">Screen</option>
                    <option value="color-dodge">Color Dodge</option>
                    <option value="linear-dodge">Linear Dodge (Add)</option>
                    <option value="lighter-color">Lighter Color</option>
                    <option disabled>──────────</option>
                    <option value="overlay">Overlay</option>
                    <option value="soft-light">Soft Light</option>
                    <option value="hard-light">Hard Light</option>
                    <option value="vivid-light">Vivid Light</option>
                    <option value="linear-light">Linear Light</option>
                    <option value="pin-light">Pin Light</option>
                    <option value="hard-mix">Hard Mix</option>
                    <option disabled>──────────</option>
                    <option value="difference">Difference</option>
                    <option value="exclusion">Exclusion</option>
                    <option value="subtract">Subtract</option>
                    <option value="divide">Divide</option>
                    <option disabled>──────────</option>
                    <option value="hue">Hue</option>
                    <option value="saturation">Saturation</option>
                    <option value="color">Color</option>
                    <option value="luminosity">Luminosity</option>
                </select>
            </div>

            <div id="color-select" class="option">
                <label for="color">Choose a color:</label>
                <input type="color" id="color" name="color" value="#ff1493">
            </div>

            <div id="color-wipe-slider" class="option">
                <label for="color-wipe">Color Wipe:</label>
                <input type="range" min="0" max="100" value="0" id="color-wipe">
            </div>

            <div id="description-container" class="option">
                <h3>Blend Mode Description</h3>
                <p id="blend-mode-description-text"></p>
            </div>

            <div id="graph-container" class="option">
                <canvas id="chart"></canvas>
            </div>

            <div id="formula-container" class="option">
                <h3>Blend Mode Formula</h3>
                <p id="blend-mode-math"></p>
            </div>
            
            <div id="dark-mode-toggle" class="option" style="margin-bottom: 0;">
                <label for="dark-mode">Dark mode:</label>
                <input type="checkbox" id="dark-mode" checked>
            </div>
        </div>
    </div>
    
    <script>
        const blendModeSelect = document.querySelector('#blend-mode');
        const colorSelect = document.querySelector('#color');
        const darkModeToggle = document.querySelector('#dark-mode');
    
        const blendModes = {
            normal: {
                formula: '\\text{Result} = T',
                definition: 'This mode simply retains the top layer.',
                function: 'normal(T, B){ return T; }',
            },
            dissolve: {
                formula: '\\text{Result} = \\text{randomly selects T or B}',
                definition: 'Affects the layer randomly, either showing the top or bottom layer per pixel.',
                function: 'dissolve(T, B){ return Math.random() < 0.5 ? T : B; }',
            },
            darken: {
                formula: '\\text{Result} = \\min(B, T)',
                definition: 'This mode selects the darker color between the top and bottom layer for each pixel.',
                function: 'darken(T, B){ return Math.min(B, T); }',
            },
            multiply: {
                formula: '\\text{Result} = B \\times T',
                definition: 'This mode multiplies the colors of the top and bottom layer, resulting in a darker color.',
                function: 'multiply(T, B){ return B * T; }',
            },
            'color-burn': {
                formula: '\\text{Result} = 1 - \\left(1 - \\frac{B}{T}\\right)',
                definition: 'Intensifies the darker tones in your image.',
                function: 'colorBurn(T, B){ return 1 - (1 - B / T); }',
            },
            'linear-burn': {
                formula: '\\text{Result} = B + T - 1',
                definition: 'Combines Multiply and Subtract blend modes. The result is darker than Multiply but lighter than Subtract.',
                function: 'linearBurn(T, B){ return B + T - 1; }',
            },
            'darker-color': {
                formula: '\\text{Result} = \\text{darker}(B, T)',
                definition: 'Compares the total of all channel values for the blend and base color and retains the lower value color.',
                function: 'darkerColor(T, B){ return darker(B, T); }', // placeholder
            },
            lighten: {
                formula: '\\text{Result} = \\max(B, T)',
                definition: 'This mode selects the lighter color between the top and bottom layer for each pixel.',
                function: 'lighten(T, B){ return Math.max(B, T); }',
            },
            screen: {
                formula: '\\text{Result} = 1 - (1 - B) \\times (1 - T)',
                definition: 'This mode multiplies the inverses of the colors of the top and bottom layer, resulting in a lighter color.',
                function: 'screen(T, B){ return 1 - (1 - B) * (1 - T); }',
            },
            'color-dodge': {
                formula: '\\text{Result} = \\frac{B}{1 - T}',
                definition: 'Brightens your image by decreasing contrast.',
                function: 'colorDodge(T, B){ return B / (1 - T); }',
            },
            'linear-dodge': {
                formula: '\\text{Result} = B + T',
                definition: 'Additive blend mode, similar to Screen but with more intense results.',
                function: 'linearDodge(T, B){ return B + T; }',
            },
            'lighter-color': {
                formula: '\\text{Result} = \\text{lighter}(B, T)',
                definition: 'Compares the total of all channel values for the blend and base color and retains the higher value color.',
                function: 'lighterColor(T, B){ return lighter(B, T); }', // placeholder
            },
            overlay: {
                formula: '\\text{Result} = (B < 0.5) ? (2 \\times B \\times T) : \\left(1 - 2 \\times (1 - B) \\times (1 - T)\\right)',
                definition: 'This mode multiplies or screens the colors depending on the base color.',
                function: 'overlay(T, B){ return (B < 0.5) ? (2 * B * T) : (1 - 2 * (1 - B) * (1 - T)); }',
            },
            'soft-light': {
                formula: '\\text{Result} = (T < 0.5) ? \\left(2 \\times B \\times T + B^2\\right) : \\left(2 \\times B \\times (1 - T) + \\sqrt{B}\\right)',
                definition: 'This mode darkens or lightens the colors by decreasing or increasing the contrast, depending on the blend color.',
                function: 'softLight(T, B){ return (T < 0.5) ? (2 * B * T + B*B) : (2 * B * (1 - T) + Math.sqrt(B)); }',
            },
            'hard-light': {
                formula: '\\text{Result} = (T < 0.5) ? (2 \\times B \\times T) : \\left(1 - 2 \\times (1 - B) \\times (1 - T)\\right)',
                definition: 'This mode multiplies or screens the colors depending on the blend color.',
                function: 'hardLight(T, B){ return (T < 0.5) ? (2 * B * T) : (1 - 2 * (1 - B) * (1 - T)); }',
            },
            'vivid-light': {
                formula: '\\text{Result} = \\text{vividLight}(B, T)',
                definition: 'Burns or dodges the colors by increasing or decreasing the contrast, depending on the blend color.',
                function: 'vividLight(T, B){ return vividLight(B, T); }', // placeholder
            },
            'linear-light': {
                formula: '\\text{Result} = \\text{linearLight}(B, T)',
                definition: 'Burns or dodges the colors by decreasing or increasing the brightness, depending on the blend color.',
                function: 'linearLight(T, B){ return linearLight(B, T); }', // placeholder
            },
            'pin-light': {
                formula: '\\text{Result} = \\text{pinLight}(B, T)',
                definition: 'Replaces the colors, depending on the blend color.',
                function: 'pinLight(T, B){ return pinLight(B, T); }', // placeholder
            },
            'hard-mix': {
                formula: '\\text{Result} = \\text{hardMix}(B, T)',
                definition: 'Adds the red, green, and blue channel values of the blend color to those of the base color.',
                function: 'hardMix(T, B){ return hardMix(B, T); }', // placeholder
            },
            difference: {
                formula: '\\text{Result} = \\left|B - T\\right|',
                definition: 'This mode subtracts the bottom layer color from the top layer or vice versa, depending on which one is lighter.',
                function: 'difference(T, B){ return Math.abs(B - T); }',
            },
            exclusion: {
                formula: '\\text{Result} = B + T - 2 \\times B \\times T',
                definition: 'This mode creates an effect similar to Difference, but with lower contrast.',
                function: 'exclusion(T, B){ return B + T - 2 * B * T; }',
            },
            subtract: {
                formula: '\\text{Result} = B - T',
                definition: 'Looks at the color information in each channel and subtracts the blend color from the base color.',
                function: 'subtract(T, B){ return B - T; }',
            },
            divide: {
                formula: '\\text{Result} = \\frac{B}{T}',
                definition: 'Looks at the color information in each channel and divides the base color by the blend color.',
                function: 'divide(T, B){ return B / T; }',
            },
            hue: {
                formula: '\\text{Result} = \\text{HSL}(\\text{Hue}(T), \\text{Saturation}(B), \\text{Luminance}(B))',
                definition: 'Result uses the hue of the TopLayer and the saturation and luminosity of the BottomLayer.',
                function: 'hue(T, B){ return hsl(hue(T), saturation(B), luminance(B)); }', // placeholder
            },
            saturation: {
                formula: '\\text{Result} = \\text{HSL}(\\text{Hue}(B), \\text{Saturation}(T), \\text{Luminance}(B))',
                definition: 'Result uses the saturation of the TopLayer and the hue and luminosity of the BottomLayer.',
                function: 'saturation(T, B){ return hsl(hue(B), saturation(T), luminance(B)); }', // placeholder
            },
            color: {
                formula: '\\text{Result} = \\text{HSL}(\\text{Hue}(T), \\text{Saturation}(T), \\text{Luminance}(B))',
                definition: 'Result uses the hue and saturation of the TopLayer and the luminosity of the BottomLayer.',
                function: 'color(T, B){ return hsl(hue(T), saturation(T), luminance(B)); }', // placeholder
            },
            luminosity: {
                formula: '\\text{Result} = \\text{HSL}(\\text{Hue}(B), \\text{Saturation}(B), \\text{Luminance}(T))',
                definition: 'Result uses the luminosity of the TopLayer and the hue and saturation of the BottomLayer.',
                function: 'luminosity(T, B){ return hsl(hue(B), saturation(B), luminance(T)); }', // placeholder
            }
        };

        window.onload = (event) => {
            // First, get references to the blend mode dropdown and the elements where you want to display the formula and description
            const blendModeSelect = document.getElementById('blend-mode');
            const blendModeMath = document.getElementById('blend-mode-math');
            const blendModeDescriptionText = document.getElementById('blend-mode-description-text');
            const darkModeCheckbox = document.getElementById('dark-mode');

            // Set initial colors based on checkbox status
            document.documentElement.style.setProperty('--bg-color', darkModeCheckbox.checked ? '#333' : '#FFF');
            document.documentElement.style.setProperty('--fg-color', darkModeCheckbox.checked ? '#eaeaea' : '#333');

            // Initialize the formula and description with the current selected blend mode
            updateBlendMode(blendModeSelect.value);

            // Then, add an event listener to the dropdown that updates the formula and description when the blend mode changes
            blendModeSelect.addEventListener('change', function(event) {
                updateBlendMode(event.target.value);
            });

            darkModeCheckbox.addEventListener('change', (event) => {
                document.documentElement.style.setProperty('--bg-color', event.target.checked ? '#333' : '#FFF');
                document.documentElement.style.setProperty('--fg-color', event.target.checked ? '#eaeaea' : '#333');
            });

            function updateBlendMode(blendMode) {
                // Get the selected blend mode
                const selectedBlendMode = blendModes[blendMode];

                // Update the formula and description
                if (selectedBlendMode) {
                    blendModeMath.textContent = '\\[' + selectedBlendMode.formula + '\\]';
                    blendModeDescriptionText.textContent = selectedBlendMode.definition;

                    // Re-render math formulas using MathJax
                    MathJax.typeset();
                }
            }
        };
    </script>
</body>
</html>